# Git Workflow Configuration for Claude Code

## /git-commit Command Implementation

### Pre-Commit Analysis Protocol
When `/git-commit` is executed, perform these steps:

1. **Verify Current Branch**
   ```bash
   git branch --show-current
   ```
   - If `master`: **ERROR** - Never commit directly to master
   - If `dev`: **WARNING** - Suggest creating feature branch
   - If `feature/*`: **OK** - Continue with workflow

2. **Analyze Changed Files**
   ```bash
   git status --porcelain
   git diff --stat
   ```
   - List all modified files
   - Show lines added/removed per file
   - Categorize changes (new, modified, deleted)

### Individual File Commit Process

For each modified file, execute:

```bash
# Stage single file
git add <file-path>

# Generate commit message using this template:
<type>(<scope>): <subject>

<body>
- Change 1 in this file
- Change 2 in this file
- Change 3 in this file

File: <file-path>
Lines: +X -Y
Testing: <verification-method>
Related: <references-if-applicable>

# Commit with generated message
git commit -m "<generated-message>"
```

### Commit Types and Scopes

#### Types:
- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation
- `style`: Code style changes
- `refactor`: Code refactoring
- `test`: Adding tests
- `chore`: Maintenance tasks

#### Scopes (based on file location):
- `api`: Backend API changes
- `ui`: Frontend UI changes
- `db`: Database changes
- `auth`: Authentication
- `video`: Video player functionality
- `events`: Event management
- `config`: Configuration changes

### Post-Commit Workflow Decision

After all files are committed, ask:

**"¿Quieres realizar un merge con la rama dev o continuar trabajando en esta rama?"**

#### Option A: Merge to dev (Complete Feature)
```bash
# Switch to dev and update
git checkout dev
git pull origin dev

# Merge with no-ff to preserve branch history
git merge --no-ff <feature-branch> -m "Merge: <auto-generated-summary>"

# Push to origin
git push origin dev

# Clean up local branch
git branch -d <feature-branch>

# Delete remote branch
git push origin --delete <feature-branch>
```

#### Option B: Continue Working
```bash
# Add session progress note
git commit --amend -m "<original-message>

[WIP] Session progress: <current-status>
- In progress: <current-task>
- Next: <next-planned-task>
- Blockers: <any-blockers>"

# Push to backup branch
git push origin <current-branch>
```

### Master Branch Deployment Protocol

When user wants to deploy to master:

1. **First Confirmation**
   ```
   ⚠️  PRODUCTION DEPLOYMENT WARNING
   
   ¿Estás seguro de que quieres publicar en master?
   Esta acción desplegará los cambios a producción.
   
   Current dev commits to be deployed:
   - [list recent commits]
   
   Type 'YES' to continue or 'NO' to cancel:
   ```

2. **Second Confirmation**
   ```
   🚨 FINAL CONFIRMATION REQUIRED
   
   Esta acción desplegará a producción y será visible para usuarios finales.
   
   ¿Confirmas el despliegue a master?
   
   Type 'DEPLOY' to confirm or 'CANCEL' to abort:
   ```

3. **Version Generation**
   ```bash
   # Get last version from master
   git checkout master
   git pull origin master
   LAST_VERSION=$(git tag --sort=-v:refname | head -1)
   
   # Compare with dev to determine version bump
   git diff master..dev --stat
   
   # Generate new version based on changes:
   # MAJOR: Breaking changes or major features
   # MINOR: New features, backward compatible
   # PATCH: Bug fixes, small improvements
   ```

4. **Deployment Execution**
   ```bash
   # Merge dev to master
   git checkout master
   git merge --no-ff dev -m "Release v<new-version>: <summary>"
   
   # Create and push tag
   git tag -a v<new-version> -m "Version <new-version>: <detailed-changelog>"
   git push origin master
   git push origin v<new-version>
   ```

### Merge Message Templates

#### Feature Merge to Dev
```
Merge: <feature-description>

Completed functionality:
- <completed-item-1>
- <completed-item-2>
- <completed-item-3>

Files modified: <count>
Tests: <test-status>
Ready for: <next-phase>
```

#### Release Merge to Master
```
Release v<version>: <release-summary>

Features:
- <feature-1>
- <feature-2>

Bug Fixes:
- <bugfix-1>
- <bugfix-2>

Breaking Changes:
- <breaking-change-1>

Migration Required: <yes/no>
Deployment Notes: <deployment-notes>
```

### Error Handling

#### Merge Conflicts
```bash
# Detect conflicts
git status | grep "both modified"

# Guide user through resolution
echo "Merge conflicts detected. Please resolve manually:"
git status
```

#### Failed Deployment
```bash
# Rollback procedure
git reset --hard HEAD~1
git push origin master --force-with-lease
```

### Branch Cleanup

#### Stale Branch Detection
```bash
# Find branches older than 30 days
git for-each-ref --format='%(refname:short) %(committerdate)' refs/heads | awk '$2 < "'$(date -d '30 days ago' '+%Y-%m-%d')'"'
```

#### Cleanup Commands
```bash
# Remove merged branches
git branch --merged dev | grep -v "master\|dev" | xargs -n 1 git branch -d

# Remove remote tracking branches
git remote prune origin
```

### Quality Assurance Checks

#### Pre-Commit Validation
- Check for console.log statements
- Verify no TODO/FIXME comments
- Ensure proper TypeScript types
- Validate code formatting

#### Pre-Merge Validation
- Run test suite
- Check build process
- Verify no compilation errors
- Validate documentation updates

### Automation Hooks

#### Pre-Commit Hook
```bash
#!/bin/sh
# Check for debugging statements
if grep -r "console\.log\|debugger" src/; then
    echo "Error: Remove debugging statements before commit"
    exit 1
fi
```

#### Pre-Push Hook
```bash
#!/bin/sh
# Run tests before push
npm test
if [ $? -ne 0 ]; then
    echo "Error: Tests must pass before push"
    exit 1
fi
```

---

This configuration ensures professional development standards with proper version control, branch management, and deployment safety.